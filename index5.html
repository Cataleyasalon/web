<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Peluquería – Citas</title>
<style>
    body {
        background-color: #121212;
        color: white;
        font-family: 'Segoe UI', sans-serif;
        margin: 0;
        padding: 0;
    }
    header {
        background-color: #1f1f1f;
        padding: 16px;
        text-align: center;
        border-bottom: 2px solid #5a2ea6;
    }
    header img {
        height: 60px;
        margin-bottom: 8px;
    }
    button {
        background-color: #7b3fe4;
        border: none;
        color: white;
        padding: 12px 16px;
        margin: 8px 0;
        border-radius: 8px;
        cursor: pointer;
        width: 100%;
        font-weight: bold;
    }
    button:hover {
        background-color: #9a66f0;
    }
    .container {
        padding: 20px;
        max-width: 600px;
        margin: 0 auto;
    }
    input, select {
        width: 100%;
        padding: 10px;
        margin-top: 6px;
        border-radius: 8px;
        border: 1px solid #555;
        background-color: #1f1f1f;
        color: white;
    }
    .appointment {
        background-color: #1f1f1f;
        border-left: 4px solid #7b3fe4;
        margin: 10px 0;
        padding: 12px;
        border-radius: 6px;
    }
    .appointment button {
        background-color: #ff4444;
        margin-top: 8px;
    }
    .appointment button:hover {
        background-color: #ff6666;
    }
</style>
</head>
<body>

<header>
    <img src="logo.png" alt="Logo Peluquería">
    <h1>Agendador de Citas</h1>
</header>

<div class="container">
    <h2>Agregar Cita</h2>
    <form id="appointmentForm">
        <label for="date">Fecha:</label>
        <input type="date" id="date" required>

        <label for="time">Hora:</label>
        <input type="time" id="time" min="06:00" max="21:00" step="1800" required>

        <button type="submit">Agendar Cita</button>
    </form>

    <h2 style="margin-top:30px;">Citas Agendadas</h2>
    <div id="appointmentsList"></div>
</div>

<script>
const STORAGE_KEY = 'peluqueria_citas';
let appointments = [];

document.addEventListener('DOMContentLoaded', () => {
    appointments = loadAppointments();
    renderAppointments();

    document.getElementById('appointmentForm').addEventListener('submit', e => {
        e.preventDefault();
        const date = document.getElementById('date').value;
        const time = document.getElementById('time').value;
        addAppointment(date, time);
    });

    // Recordatorio a las 10:00 p.m.
    setInterval(checkReminder, 60000); 
});

function loadAppointments() {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (!stored) return [];

    const data = JSON.parse(stored);
    const now = new Date();
    const limit = new Date(now.getFullYear(), now.getMonth() - 4, now.getDate());

    const filtered = data.filter(a => new Date(a.dateTime) >= limit);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(filtered));
    return filtered;
}

function saveAppointments() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(appointments));
}

function addAppointment(dateStr, timeStr) {
    const newDate = new Date(`${dateStr}T${timeStr}`);
    const now = new Date();

    if (newDate <= now) {
        alert("No puedes agendar una cita en el pasado.");
        return;
    }

    const newMonth = newDate.getMonth();
    const newYear = newDate.getFullYear();

    const duplicate = appointments.some(a => {
        const existing = new Date(a.dateTime);
        return existing.getMonth() === newMonth &&
               existing.getFullYear() === newYear &&
               Math.abs(existing - newDate) < (30 * 60 * 1000);
    });

    if (duplicate) {
        alert("Ya existe una cita cercana en este mes (mínimo 30 minutos de diferencia).");
        return;
    }

    appointments.push({ id: Date.now(), dateTime: newDate.toISOString() });
    saveAppointments();
    renderAppointments();
    alert("✅ Cita agendada correctamente.");
}

function renderAppointments() {
    const list = document.getElementById('appointmentsList');
    list.innerHTML = '';

    if (appointments.length === 0) {
        list.innerHTML = '<p>No hay citas registradas.</p>';
        return;
    }

    appointments.sort((a, b) => new Date(a.dateTime) - new Date(b.dateTime));

    appointments.forEach(a => {
        const d = new Date(a.dateTime);
        const div = document.createElement('div');
        div.className = 'appointment';
        div.innerHTML = `
            <strong>${d.toLocaleDateString('es-MX', { weekday: 'long', day: 'numeric', month: 'long' })}</strong><br>
            Hora: ${d.toLocaleTimeString('es-MX', { hour: '2-digit', minute: '2-digit' })}
            <br><button onclick="cancelAppointment(${a.id})">Cancelar</button>
        `;
        list.appendChild(div);
    });
}

function cancelAppointment(id) {
    if (confirm("¿Deseas cancelar esta cita?")) {
        appointments = appointments.filter(a => a.id !== id);
        saveAppointments();
        renderAppointments();
        alert("Cita cancelada correctamente.");
    }
}

function checkReminder() {
    const now = new Date();
    if (now.getHours() === 22 && now.getMinutes() === 0) {
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        const citasMañana = appointments.filter(a => {
            const d = new Date(a.dateTime);
            return d.toDateString() === tomorrow.toDateString();
        });

        if (citasMañana.length > 0) {
            const mensaje = "Tienes " + citasMañana.length + " cita(s) para mañana.";
            showNotification(mensaje);
        }
    }
}

function showNotification(text) {
    const div = document.createElement('div');
    div.textContent = text;
    div.style.position = 'fixed';
    div.style.bottom = '20px';
    div.style.right = '20px';
    div.style.background = '#7b3fe4';
    div.style.color = 'white';
    div.style.padding = '16px';
    div.style.borderRadius = '8px';
    div.style.boxShadow = '0 0 10px rgba(0,0,0,0.4)';
    document.body.appendChild(div);
    const audio = new Audio('https://cdn.pixabay.com/download/audio/2022/03/15/audio_73e37a7b8c.mp3?filename=notification-3-199884.mp3');
    audio.play();
    setTimeout(() => div.remove(), 6000);
}
</script>

</body>
</html>
